# 操作系统核心知识

> 操作系统两大功能：一是任务管理，二是资源管理（资源只有两类，内存 & I/O）
> 文件是对 I/O 设备的抽象，虚存是对内存+文件的抽象，任务是对 CPU+虚存的抽象

- 1、任务管理
  - 任务抽象：进程、线程
  - 任务调度：机制、策略
  - 任务通信（IPC，inter-process communication）
    - 同系统
      - 用于单向传递数据
        - **Pipe 管道**
        - **Signal 信号**
      - 用于相互传递数据
        - **File 文件**
        - **Shared memory 共享内存**
        - **Message queue 消息队列**
      - 用于同步
        - **Semaphore 信号量**
    - 跨系统
      - **Socket 套接字**
  - 任务并发
    - 竞态问题 -> 同步（互斥、原子性）
    - 同步的衍生问题：死锁、活锁、饥饿 -> 如何解决
- 2、内存管理
  - 物理内存：分配机制（分段、分页）
  - 虚拟内存：换页机制（内存过载如何解决）
- 3、I/O 与文件
  - 磁盘：RAID（Redundant Array of Independent Disks）
- 4、其他主题


### 任务并发

- 核心问题 
  - **竞态**问题：对共享变量/资源的竞争陷阱（写入覆盖风险） -> 需要某种**同步**机制，确保每个线程的执行序列或者对资源的使用都具有**互斥**性、**原子性**、排他性、独占性（同步是手段，互斥的效果）
  - 同步衍生的问题：**死锁**、**活锁**、**饥饿**
    - 死锁：基本模式是两个进程同时在等待两个资源的使用权，而这两个资源分别被两个进程持有且不会被主动释放，操作系统无法执行资源分配，陷入死局
    - 活锁：
    - 饥饿：部分进程持续占用资源，导致其他进程永远无法分配到资源
    - 共同表现：忙等待（busy waiting）与自旋等待（spin waiting）：在互斥约束下，如果临界区已经被占用（资源已被排他性占用），那么代码只能循环检测资源何时被释放
- 同步机制（synchronization）
  - **互斥锁**机制：对单一资源加锁
    - 硬件提供的实现：**禁用中断**。因为写入相互覆盖的原因是指令因中断导致执行顺序出现交叉，所以禁用中断即可。问题是执行效率降低、不适用于多处理器
    - 软硬件协同提供的实现：**原子指令**
    - 软件提供的实现：皮森特算法
  - **信号量**机制：对一到多个资源加锁
    - **信号量**：初始值表示可用资源数量，一个进程占用一个资源，就将信号量减一，释放一个资源，就将信号量加一，信号量为 0 表示无资源可用，进程只能等待。信号量不能为负
  - **条件变量**机制
  - **读写锁**机制
  - **RCU**机制
  - **管程**机制
  

